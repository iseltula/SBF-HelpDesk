<script type="text/javascript">
  //Register Node
  RED.nodes.registerType('prompt-choice-dialog', {
      category: 'SBF',
      color: '#EAFB7B',
      defaults: {
          name: {
              value: '',
              required: true
          },
          options: {
              value: [],
              required: true,
              validate: function (options) {
                  return options.length > 0;
              }
          }
      },
      outputs: 1,
      inputs: 1,
      icon: 'bridge.png',
      label: function () {
          return this.name || 'prompt-choice-dialog';
      },
      labelStyle: function () {
          return this.name === '' ? 'node_label_italic' : '';
      },
      mixins: {
          botPersonality: {
              container: "#node-input-dialog-container"
          }
      },
      oneditprepare: function () {
          debugger;
          var node = this;
          $("#node-input-options-container").editableList({
              addItem: function (container, i, opt) {
                  var row = $('<div/>', {
                      class: "row-fluid"
                  }).appendTo(container);

                  var optionField = $('<input/>', {
                      class: "node-input-options-value span12",
                      type: "text",
                      placeholder: "Choice"
                  }).appendTo(row);

                  if (!jQuery.isEmptyObject(opt)) {
                      optionField.attr('value', opt);
                  }
              },
              removeItem: function (opt) {
                  var options = $("#node-input-options-container").editableList('items');
                  options.each(function (i) {
                      $(this).find(".node-input-options-index").html(i + 1);
                  });
              },
              removable: true
          });

          if (node.options && node.options.length > 0) {
              for (var mCount = 0; mCount < node.options.length; mCount++) {
                  $("#node-input-options-container").editableList('addItem', node.options[mCount]);
              }
          } else {
              $("#node-input-options-container").editableList('addItem', '');
          }
      },
      oneditsave: function () {
          var options = $("#node-input-options-container").editableList('items');
          var node = this;
          node.options = [];
          options.each(function (i) {
              var option = $(this).find(".node-input-options-value").val();
              if ($(this).find(".node-input-options-value").val()) {
                  node.options.push(option);
              }
          });
      }
  });
</script>
<script type="text/x-red" data-template-name="prompt-choice-dialog">
  <div class="form-row">
    <label for="node-input-name">Name</label>
    <input type="text" id="node-input-name" placeholder="Name" />
  </div>
  <h3>Dialog Message</h3>
   <div class="form-row">
    <ol id="node-input-dialog-container"></ol>
  </div>
  <h3>Choices</h3>
  <div class="form-row">
    <ol id="node-input-options-container"></ol>
  </div>

</script>
<script type="text/x-red" data-help-name="prompt-choice-dialog">
  <p><strong>Purpose: </strong> to provide a list of options for the user to choose from</p>
  <p><strong>How to use: </strong></p>
  <ul>
    <li>Set the name of the Dialog</li>
    <li>Set the Dialog Text for the Dialog you want to display with your choices.</li>
    <li>Click on 'Add Choice' to add new Choices to the Dialog.</li>
    <li>Type your new choice and click 'Save' to add it to the List.</li>
    <li>When you are finish click 'Done'</li>
  </ul>
  <p><strong>Inputs: </strong> sbf object from the Intent Matcher and any result from previous dialogs</p>
  <p><strong>Outputs: </strong> sets a new property to the message object</p>
  <p><pre><code>node.send({
      sbf: {
        session: Object, // object of the Bot Framework session
        botServer: {
          bot: Object, // object of the Bot Framework Universal Bot
          intent: Object, // object of the builder.IntentDialog for LUIS
          connector: Object, // object of the builder.ChatConnector for listening to a URL
        },
        luisArgs: Object // object of the LUIS intent matching object         
      },
      payload{
       response: {
            entity: String //  Response from the previous dialog
          }
      }
    });</code></pre></p>
  <p><strong>Quick Tips: </strong></p>
  <ul>
    <li>It is recommended to Deploy afer creating each dialog, to save the changes.</li>
    <li>If when deploy an error is display. Just re-open the dialog and Save it again. </li>
  </ul>.</p>
</script>